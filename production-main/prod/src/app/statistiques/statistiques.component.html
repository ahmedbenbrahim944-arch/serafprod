<div class="stats-container">

  <button class="btn-retour-choix" (click)="retourChoix()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
    Retour 
  </button>
  <!-- Header -->
  <div class="header">
    <h1>Statistiques de Production</h1>
    
    <div class="controls">
      <div class="week-selector">
        <label for="semaine">Semaine :</label>
        <select 
          id="semaine" 
          [(ngModel)]="semaineSelectionnee" 
          class="semaine-select">
          <option *ngFor="let num of getSemainesArray()" [value]="'semaine' + num">
            Semaine {{ num }}
          </option>
        </select>
      </div>
      
      <button 
        class="btn-charger" 
        (click)="chargerStatistiques()"
        [disabled]="isLoading">
        <span *ngIf="!isLoading">Afficher les statistiques</span>
        <span *ngIf="isLoading">Chargement...</span>
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Chargement des données...</p>
  </div>

  <!-- Statistiques -->
  <div *ngIf="showStats && !isLoading" class="stats-content">
    
    <!-- Lignes -->
    <div class="lignes-section">
      <h2>Lignes de production</h2>
      <div class="lignes-list">
        <div 
          *ngFor="let ligne of statsLignes" 
          class="ligne-card"
          [class.selected]="ligne.ligne === ligneSelectionnee"
          (click)="selectionnerLigne(ligne.ligne)">
          
          <div class="ligne-header">
            <span class="ligne-nom">{{ ligne.ligne }}</span>
            <span class="ligne-percentage">{{ ligne.pcsProdTotal.toFixed(1) }}%</span>
          </div>
          
          <div class="progress-bar">
            <div 
              class="progress-fill" 
              [style.width.%]="ligne.pcsProdTotal"
              [style.background-color]="getColorForPercentage(ligne.pcsProdTotal)">
            </div>
          </div>
          
          <div class="ligne-details">
            <span>Planifications: {{ ligne.nombrePlanifications }}</span>
            <span>Références: {{ ligne.nombreReferences }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Graphiques -->
    <div class="charts-section">
      <!-- Histogramme -->
      <div class="chart-card">
        <h3>Production par ligne - {{ semaineSelectionnee }}</h3>
        <div class="chart-wrapper">
          <canvas id="barChart"></canvas>
        </div>
      </div>

      <!-- Graphiques circulaires -->
      <div class="pie-charts-grid">
        <div *ngFor="let ligne of statsLignes" class="pie-card">
          <h4>{{ ligne.ligne }}</h4>
          <div class="pie-wrapper">
            <canvas [id]="'pieChart-' + ligne.ligne"></canvas>
            <div class="pie-center">
              <span class="percentage">{{ ligne.pcsProdTotal.toFixed(0) }}%</span>
              <span class="label">Rendement</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Message initial -->
  <div *ngIf="!showStats && !isLoading" class="welcome-card">
    <div class="welcome-icon"></div>
    <h2></h2>
    <p></p>
  </div>
</div>