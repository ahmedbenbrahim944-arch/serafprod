<div class="stats-container">

  <button class="btn-retour-choix" (click)="retourChoix()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
    Retour 
  </button>

  <!-- Header -->
  <div class="header">
    <h1>Statistiques de Production</h1>
    
    <div class="controls">
      <div class="week-selector">
        <label for="semaine">Semaine :</label>
        <select 
          id="semaine" 
          [(ngModel)]="semaineSelectionnee" 
          class="semaine-select">
          <option *ngFor="let num of getSemainesArray()" [value]="'semaine' + num">
            Semaine {{ num }}
          </option>
        </select>
      </div>
      
      <button 
        class="btn-charger" 
        (click)="chargerStatistiques()"
        [disabled]="isLoading">
        <span *ngIf="!isLoading">Afficher les statistiques</span>
        <span *ngIf="isLoading">Chargement...</span>
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Chargement des données...</p>
  </div>

  <!-- Statistiques -->
  <div *ngIf="showStats && !isLoading" class="stats-content">
    
    <!-- Layout avec sidebar et contenu principal -->
    <div class="main-layout">
      
      <!-- Sidebar - Lignes -->
      <div class="lignes-sidebar">
        <h2>Lignes de production</h2>
        <div class="lignes-list">
          <div 
            *ngFor="let ligne of statsLignes" 
            class="ligne-card"
            [class.selected]="ligne.ligne === ligneSelectionnee"
            (click)="selectionnerLigne(ligne.ligne)">
            
            <div class="ligne-header">
              <span class="ligne-nom">{{ ligne.ligne }}</span>
              <span class="ligne-percentage">{{ ligne.pcsProdTotal.toFixed(1) }}%</span>
            </div>
            
            <div class="progress-bar">
              <div 
                class="progress-fill" 
                [style.width.%]="ligne.pcsProdTotal"
                [style.background-color]="getColorForPercentage(ligne.pcsProdTotal)">
              </div>
            </div>
            
            <div class="ligne-details">
              <span>Planifications: {{ ligne.nombrePlanifications }}</span>
              <span>Références: {{ ligne.nombreReferences }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Contenu principal - Graphiques -->
      <div class="main-content">
        
        <!-- Histogramme -->
        <div class="chart-card">
          <h3>Production par ligne - {{ semaineSelectionnee }}</h3>
          <div class="chart-wrapper">
            <canvas id="barChart"></canvas>
          </div>
        </div>

        <!-- Les 5M totaux de la semaine -->
        <div class="cinq-m-section">
          <h3>Analyse des 5M - {{ semaineSelectionnee }}</h3>
          
          <div class="cinq-m-grid">
            
            <!-- Matière Première -->
            <div class="m-card">
              <div class="m-chart-wrapper">
                <canvas id="pieChart-matierePremiere"></canvas>
                <div class="m-center">
                  <span class="m-percentage">{{ (stats5M?.matierePremiere ?? 0).toFixed(1) }}%</span>
                </div>
              </div>
              <div class="m-info">
                <h4>Matière Première</h4>
                <p class="m-description">Écarts liés aux matières premières</p>
              </div>
            </div>

            <!-- Absence -->
            <div class="m-card">
              <div class="m-chart-wrapper">
                <canvas id="pieChart-absence"></canvas>
                <div class="m-center">
                  <span class="m-percentage">{{ (stats5M?.absence ?? 0).toFixed(1) }}%</span>
                </div>
              </div>
              <div class="m-info">
                <h4>Absence</h4>
                <p class="m-description">Écarts dus aux absences</p>
              </div>
            </div>

            <!-- Rendement -->
            <div class="m-card">
              <div class="m-chart-wrapper">
                <canvas id="pieChart-rendement"></canvas>
                <div class="m-center">
                  <span class="m-percentage">{{ (stats5M?.rendement ?? 0).toFixed(1) }}%</span>
                </div>
              </div>
              <div class="m-info">
                <h4>Rendement</h4>
                <p class="m-description">Écarts de rendement</p>
              </div>
            </div>

            <!-- Maintenance -->
            <div class="m-card">
              <div class="m-chart-wrapper">
                <canvas id="pieChart-maintenance"></canvas>
                <div class="m-center">
                  <span class="m-percentage">{{ (stats5M?.maintenance ?? 0).toFixed(1) }}%</span>
                </div>
              </div>
              <div class="m-info">
                <h4>Maintenance</h4>
                <p class="m-description">Écarts dus à la maintenance</p>
              </div>
            </div>

            <!-- Qualité -->
            <div class="m-card">
              <div class="m-chart-wrapper">
                <canvas id="pieChart-qualite"></canvas>
                <div class="m-center">
                  <span class="m-percentage">{{ (stats5M?.qualite ?? 0).toFixed(1) }}%</span>
                </div>
              </div>
              <div class="m-info">
                <h4>Qualité</h4>
                <p class="m-description">Écarts de qualité</p>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Message initial -->
  <div *ngIf="!showStats && !isLoading" class="welcome-card">
    <div class="welcome-icon"></div>
    <h2>Bienvenue</h2>
    <p>Sélectionnez une semaine et cliquez sur "Afficher les statistiques"</p>
  </div>
</div>