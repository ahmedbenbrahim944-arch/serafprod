  <!-- Background avec particules -->
 

  <!-- Syst√®me de particules -->
  <div class="absolute inset-0 pointer-events-none overflow-hidden">
    <div *ngFor="let particle of particles()" 
         class="particle absolute rounded-full bg-cyan-400/40"
         [style.left]="particle.left"
         [style.animation-delay]="particle.animationDelay"
         [style.width]="particle.size"
         [style.height]="particle.size"
         [style.opacity]="particle.opacity">
    </div>
  </div>

  <!-- Container principal -->
  <div class="relative z-10 container mx-auto px-2 py-8">
    <!-- Header avec bouton de retour -->
    <header class="text-center mb-12 relative">
      <!-- Bouton de retour au login -->

      
    </header>

    <!-- Navigation par onglets -->
    <div class="app-container">
  <!-- Bouton hamburger pour mobile -->
  <button class="hamburger-menu" (click)="toggleMobileSidebar()">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
    </svg>
  </button>

  <!-- Sidebar -->
  <aside class="sidebar" [class.mobile-open]="mobileMenuOpen">
    <!-- Header de la sidebar -->
    <div class="sidebar-header">
      <h1 class="sidebar-title">PDP</h1>
    </div>

    <!-- Navigation -->
   <nav class="sidebar-nav">
  <div class="nav-section">
    <button 
      (click)="setActiveTab('view')"
      class="nav-button"
      [class.active]="activeTab() === 'view'">
      <img src="assets/icons/production.png" alt="View" class="nav-button-icon">
      Voir les Lignes
    </button>
  

        <button 
          (click)="setActiveTab('create')"
          class="nav-button"
          [class.active]="activeTab() === 'create'">
          <img src="assets/icons/plus.png" alt="View" class="nav-button-icon">
          Nouvelle Ligne
        </button>

        <button 
          (click)="setActiveTab('add-ref')"
          class="nav-button"
          [class.active]="activeTab() === 'add-ref'">
          <img src="assets/icons/ajouter.png" alt="View" class="nav-button-icon">
          Ajouter R√©f√©rences
        </button>

        <button 
          (click)="setActiveTab('new-week')"
          class="nav-button"
          [class.active]="activeTab() === 'new-week'">
          <img src="assets/icons/semaine.png" alt="View" class="nav-button-icon">
          Nouvelle Semaine
        </button>

        <button 
          [routerLink]="['/planification']"
          class="nav-button"
          [class.active]="activeTab() === 'planning'">
          <img src="assets/icons/planifier.png" alt="View" class="nav-button-icon">
          Planification
        </button>

            <button 
          *ngIf="isAdmin()"
          (click)="setActiveTab('view-stats')"
          class="nav-button"
          [class.active]="activeTab() === 'view-stats'">
          <img src="assets/icons/stat.png" alt="View" class="nav-button-icon">
          Voir Statistiques
        </button>

        <button 
          (click)="setActiveTab('add-user')"
          class="nav-button"
          [class.active]="activeTab() === 'add-user'">
          <img src="assets/icons/adduser.png" alt="View" class="nav-button-icon">
          Ajouter Utilisateur
        </button>

        <button 
          (click)="setActiveTab('add-time')"
          class="nav-button"
          [class.active]="activeTab() === 'add-time'">
          <img src="assets/icons/temps.png" alt="View" class="nav-button-icon">
          Ajouter Temps
        </button>

        <button 
          (click)="setActiveTab('add-worker')"
          class="nav-button"
          [class.active]="activeTab() === 'add-worker'">
          <img src="assets/icons/ouvriers.png" alt="View" class="nav-button-icon">
          Ajouter Ouvrier
        </button>

        <button 
          (click)="setActiveTab('add-phase')"
          class="nav-button"
          [class.active]="activeTab() === 'add-phase'">
          <img src="assets/icons/pahse.png" alt="View" class="nav-button-icon">
          Ajouter Phase
        </button>

        <button 
          (click)="setActiveTab('download-phase')"
          class="nav-button"
          [class.active]="activeTab() === 'download-phase'">
          <img src="assets/icons/pahse.png" alt="View" class="nav-button-icon">
          rappor Phase
        </button>

        <button 
          (click)="setActiveTab('download-line-summary')"
          class="nav-button"
          [class.active]="activeTab() === 'download-line-summary'">
          <img src="assets/icons/loupe.png" alt="View" class="nav-button-icon">
          R√©sum√© Ligne
        </button>
      </div>
    </nav>

    <!-- Bouton de d√©connexion -->
    <button class="logout-button" (click)="goBackToLogin()">
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
      </svg>
      Retour Login
    </button>
  </aside>

  <!-- Contenu principal -->
  <main class="main-content">
    <!-- Container du contenu -->
    <div class="container mx-auto px-4 py-8">

    <!-- Statistiques -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="stat-card bg-gradient-to-br from-cyan-600/20 to-cyan-800/20">
        <div class="text-3xl font-bold text-cyan-400">{{ getTotalLines() }}</div>
        <div class="text-cyan-200">Lignes Actives</div>
      </div>
      <div class="stat-card bg-gradient-to-br from-green-600/20 to-green-800/20">
        <div class="text-3xl font-bold text-green-400">{{ getTotalReferences() }}</div>
        <div class="text-green-200">R√©f√©rences</div>
      </div>
      <div class="stat-card bg-gradient-to-br from-purple-600/20 to-purple-800/20">
        <div class="text-3xl font-bold text-purple-400">{{ lines().length }}</div>
        <div class="text-purple-200">R√©sultats</div>
      </div>
      <div class="stat-card bg-gradient-to-br from-indigo-600/20 to-indigo-800/20">
        <div class="text-3xl font-bold text-indigo-400">{{ getTotalUsers() }}</div>
        <div class="text-indigo-200">Utilisateurs</div>
      </div>
    </div>

    <!-- Onglet: Voir les lignes -->
    <div *ngIf="activeTab() === 'view'" class="fade-in">
      <!-- Barre de recherche -->
      <div class="mb-8">
        <div class="relative max-w-2xl mx-auto">
          <input 
            type="text" 
            [(ngModel)]="searchQuery"
            (input)="onSearch()"
            placeholder="Rechercher une ligne ou r√©f√©rence..."
            class="search-input w-full pl-12 pr-4 py-4 rounded-2xl bg-gray-800/80 backdrop-blur-sm border border-gray-600/30 text-white placeholder-gray-400 focus:outline-none focus:border-cyan-500 focus:ring-4 focus:ring-cyan-500/20 transition-all duration-300">
          <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </div>
        </div>
      </div>

      <!-- Liste des lignes -->
      <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-17">
        <div *ngFor="let line of lines()" 
             (click)="selectLine(line)"
             class="line-card group cursor-pointer transform hover:scale-105 transition-all duration-300">
          
          <!-- Image de la ligne -->
          <div class="line-image-container">
            <img 
              [src]="line.imageUrl"
              [alt]="line.ligne"
              class="line-image">
            <div class="line-overlay">
              <div class="bg-black/60 backdrop-blur-sm rounded-full px-3 py-1">
                <span class="text-cyan-400 font-semibold">{{ line.referenceCount }} r√©f.</span>
              </div>
            </div>
          </div>

          <!-- Informations de la ligne -->
          <div class="line-info">
            <h3 class="line-title">{{ line.ligne }}</h3>
            <div class="references-container">
              <div *ngFor="let ref of line.references.slice(0, 3)" class="reference-tag">
                {{ ref }}
              </div>
              <div *ngIf="line.references.length > 3" class="reference-more">
                +{{ line.references.length - 3 }} plus
              </div>
            </div>
            <div class="line-footer">
              <span class="text-gray-400 text-sm">
                {{ line.lastCreated | date:'dd/MM/yyyy HH:mm' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Message vide -->
      <div *ngIf="lines().length === 0" class="text-center py-12">
        <div class="text-gray-400 text-lg">
          {{ loading() ? 'Chargement...' : 'Aucune ligne trouv√©e' }}
        </div>
      </div>
    </div>

    <!-- Onglet: T√©l√©charger les Rapports de Phase -->
<!-- Dans le template de t√©l√©chargement de phase -->
<div *ngIf="activeTab() === 'download-phase'" class="fade-in">
  <div class="max-w-2xl mx-auto">
    <div class="creation-card">
      <h2 class="text-2xl font-bold text-red-400 mb-6">T√©l√©charger les Rapports de Phase</h2>
      <p class="text-gray-400 mb-6">T√©l√©chargez tous les rapports de phase d'une semaine sp√©cifique au format Excel</p>
      
      <!-- Message d'erreur principal -->
      <div *ngIf="errorMessage()" class="mb-6 p-4 bg-red-900/30 border border-red-700 rounded-xl animate-shake">
        <div class="flex items-start">
          <svg class="w-6 h-6 text-red-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <div>
            <p class="text-gray-900 font-bold">{{ errorMessage() }}</p>
            <p class="text-gray-800 text-sm mt-1">
              V√©rifiez le nom de la semaine et r√©essayez.
              <span *ngIf="downloadPhaseForm.semaine.includes('semaine')" class="ml-1">
                Semaines disponibles: semaine1 √† semaine52
              </span>
            </p>
          </div>
        </div>
      </div>
      
      <form (ngSubmit)="onDownloadPhaseReports()" class="space-y-6">
        <!-- S√©lection de la semaine -->
        <div>
  <label class="form-label">S√©lectionner la Semaine *</label>
  
  <!-- Bo√Æte de s√©lection des semaines -->
  <select 
    [(ngModel)]="downloadPhaseForm.semaine" 
    name="semaine"
    (ngModelChange)="onSemaineChange($event)"
    class="form-input pl-12"
    [class.error]="downloadPhaseForm.errors.semaine"
    [class.border-red-500]="errorMessage()?.includes('n\'existe pas')">
    
    <option value="" disabled selected>S√©lectionnez une semaine</option>
    
    <!-- G√©n√©rer les options de semaine1 √† semaine52 -->
    <option *ngFor="let week of getWeeksList()" [value]="week">
      {{ week }}
    </option>
    
  </select>
  
  <div *ngIf="downloadPhaseForm.errors.semaine" class="form-error">
    {{ downloadPhaseForm.errors.semaine }}
  </div>
  
  <!-- Indicateur de semaine s√©lectionn√©e -->
  <div *ngIf="downloadPhaseForm.semaine" class="mt-3 p-3 bg-gray-700/30 rounded-xl border border-red-500/30">
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <svg class="w-5 h-5 text-red-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        <div>
          <span class="text-sm text-gray-400">Semaine s√©lectionn√©e :</span>
          <div class="font-semibold text-red-400">{{ downloadPhaseForm.semaine }}</div>
        </div>
      </div>
      <div class="text-xs bg-red-600/20 text-red-300 px-2 py-1 rounded">
        N¬∞ {{ downloadPhaseForm.semaine.replace('semaine', '') }}
      </div>
    </div>
  </div>
  
  <div class="text-sm text-gray-400 mt-1">
    52 semaines disponibles (semaine1 √† semaine52)
  </div>
  
  <!-- Suggestions de semaines (optionnel - √† garder si utile) -->
  <div *ngIf="downloadPhaseForm.semaine.trim() && errorMessage()" class="mt-3">
    <p class="text-sm text-gray-400 mb-2">Semaines r√©centes :</p>
    <div class="flex flex-wrap gap-2">
      <button 
        type="button"
        (click)="downloadPhaseForm.semaine = 'semaine4'"
        class="px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg text-xs transition-all duration-300">
        semaine4
      </button>
      <button 
        type="button"
        (click)="downloadPhaseForm.semaine = 'semaine47'"
        class="px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg text-xs transition-all duration-300">
        semaine47
      </button>
      <button 
        type="button"
        (click)="downloadPhaseForm.semaine = 'semaine48'"
        class="px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg text-xs transition-all duration-300">
        semaine48
      </button>
      <button 
        type="button"
        (click)="downloadPhaseForm.semaine = 'semaine49'"
        class="px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-lg text-xs transition-all duration-300">
        semaine49
      </button>
    </div>
  </div>
</div>

        <!-- Boutons d'action -->
        <div class="flex gap-4">
          <button 
            type="button" 
            (click)="onCancelDownloadPhase()"
            class="flex-1 py-4 rounded-xl font-semibold transition-all duration-300 bg-gray-600 hover:bg-gray-500 text-white">
            Annuler
          </button>
          
          <button 
            type="submit" 
            [disabled]="loading() || !downloadPhaseForm.semaine.trim()"
            class="flex-1 submit-btn py-4 rounded-xl font-semibold transition-all duration-300 bg-red-600 hover:bg-red-500 text-white disabled:opacity-50 disabled:cursor-not-allowed">
            <span class="flex items-center justify-center">
              <span *ngIf="loading()" class="loader-small mr-2"></span>
              {{ loading() ? 'Pr√©paration du t√©l√©chargement...' : 
                 'üì• T√©l√©charger Excel' }}
              <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
            </span>
          </button>
        </div>
      </form>


      
      <!-- Statistiques de la semaine (si disponibles) -->
      <div *ngIf="weekStats() && downloadPhaseForm.semaine.trim()" class="mt-8 pt-8 border-t border-gray-700">
        <h3 class="text-lg font-semibold text-red-400 mb-4">
          Statistiques pour "{{ downloadPhaseForm.semaine }}"
        </h3>
        
        <div *ngIf="loadingStats()" class="text-center py-4">
          <div class="loader-small mx-auto"></div>
          <p class="text-gray-400 mt-2">Chargement des statistiques...</p>
        </div>
        
        <div *ngIf="weekStats() && !loadingStats() && weekStats().message" 
             class="p-4 bg-yellow-900/20 border border-yellow-700/30 rounded-xl">
          <div class="flex items-center text-yellow-300">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.998-.833-2.732 0L4.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
            </svg>
            <span>{{ weekStats().message }}</span>
          </div>
        </div>
        
        <div *ngIf="weekStats() && !loadingStats() && !weekStats().message" 
             class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="stat-card bg-gradient-to-br from-red-600/20 to-red-800/20">
            <div class="text-2xl font-bold text-red-400">{{ weekStats()!.totalRapports || 0 }}</div>
            <div class="text-red-200">Rapports</div>
          </div>
          <div class="stat-card bg-gradient-to-br from-orange-600/20 to-orange-800/20">
            <div class="text-2xl font-bold text-orange-400">{{ weekStats()!.totalOuvriers || 0 }}</div>
            <div class="text-orange-200">Ouvriers</div>
          </div>
          <div class="stat-card bg-gradient-to-br from-yellow-600/20 to-yellow-800/20">
            <div class="text-2xl font-bold text-yellow-400">{{ weekStats()!.totalLignes || 0 }}</div>
            <div class="text-yellow-200">Lignes</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="activeTab() === 'download-line-summary'" class="fade-in">
  <div class="max-w-2xl mx-auto">
    <div class="creation-card">
      <h2 class="text-2xl font-bold text-amber-400 mb-6">T√©l√©charger le R√©sum√© par Ligne</h2>
      <p class="text-gray-400 mb-6">G√©n√©rez un rapport Excel d√©taill√© pour une ligne sp√©cifique sur une semaine</p>
      
      <!-- Message d'erreur -->
      <div *ngIf="errorMessage()" class="mb-6 p-4 bg-red-900/30 border border-red-700 rounded-xl animate-shake">
        <div class="flex items-start">
          <svg class="w-6 h-6 text-red-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <div>
            <p class="text-gray-900 font-bold">{{ errorMessage() }}</p>
          </div>
        </div>
      </div>
      
      <form (ngSubmit)="onDownloadLineSummary()" class="space-y-6">
        <!-- S√©lection de la semaine -->
        <div>
  <label class="form-label">S√©lectionner la Semaine *</label>
  
  <!-- Bo√Æte de s√©lection des semaines -->
  <select 
    [(ngModel)]="downloadLineSummaryForm.semaine" 
    name="semaine"
    (ngModelChange)="onSemaineChangeForLineSummary($event)"
    class="form-input"
    [class.error]="downloadLineSummaryForm.errors.semaine">
    
    <option value="" disabled selected>S√©lectionnez une semaine</option>
    
    <!-- G√©n√©rer les options de semaine1 √† semaine52 -->
    <option *ngFor="let week of getWeeksList()" [value]="week">
      {{ week }}
    </option>
    
  </select>
  
  <div *ngIf="downloadLineSummaryForm.errors.semaine" class="form-error">
    {{ downloadLineSummaryForm.errors.semaine }}
  </div>
  
  <!-- Aper√ßu de la semaine s√©lectionn√©e -->
  <div *ngIf="downloadLineSummaryForm.semaine" class="mt-3 p-3 bg-gray-700/30 rounded-xl border border-amber-500/30">
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <svg class="w-5 h-5 text-amber-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
        <div>
          <span class="text-sm text-gray-400">Semaine s√©lectionn√©e :</span>
          <div class="font-semibold text-amber-400">{{ downloadLineSummaryForm.semaine }}</div>
        </div>
      </div>
      <div class="text-xs bg-amber-600/20 text-amber-300 px-2 py-1 rounded">
        N¬∞ {{ downloadLineSummaryForm.semaine.replace('semaine', '') }}
      </div>
    </div>
  </div>
</div>

        <!-- S√©lection de la ligne -->
        <div>
          <label class="form-label">S√©lectionner la Ligne *</label>
          <select 
            [(ngModel)]="downloadLineSummaryForm.ligne" 
            name="ligne"
            (change)="onLigneSelectedForSummary()"
            class="form-input"
            [class.error]="downloadLineSummaryForm.errors.ligne">
            <option value="" disabled selected>S√©lectionnez une ligne</option>
            <option *ngFor="let line of lines()" [value]="line.ligne">
              {{ line.ligne }}
            </option>
          </select>
          <div *ngIf="downloadLineSummaryForm.errors.ligne" class="form-error">
            {{ downloadLineSummaryForm.errors.ligne }}
          </div>
        </div>

        <!-- Aper√ßu des statistiques -->
        <div *ngIf="lineSummaryStats()" class="mt-6 p-4 bg-gray-800/50 rounded-xl border border-amber-500/30">
          <h3 class="text-lg font-semibold text-amber-400 mb-3">Aper√ßu des donn√©es</h3>
          
          <!-- Statistiques principales -->
          <div *ngIf="lineSummaryStats().stats" class="grid grid-cols-2 gap-4 mb-4">
            <div class="stat-item">
              <div class="text-green-300 font-bold text-xl">{{ lineSummaryStats().stats.totalQtePlanifiee || 0 }}</div>
              <div class="text-gray-300 text-sm">Qt√© Planifi√©e</div>
            </div>
            <div class="stat-item">
              <div class="text-blue-300 font-bold text-xl">{{ lineSummaryStats().stats.totalDecProduction || 0 }}</div>
              <div class="text-gray-300 text-sm">D√©c. Production</div>
            </div>
            <div class="stat-item">
              <div class="text-purple-300 font-bold text-xl">{{ lineSummaryStats().stats.pcsProdTotal || 0 }}%</div>
              <div class="text-gray-300 text-sm">PCS Prod Total</div>
            </div>
          </div>

          <!-- Liste des planifications -->
          <div *ngIf="lineSummaryStats().planifications && lineSummaryStats().planifications.length > 0" class="mt-4">
            <h4 class="text-amber-300 font-medium mb-2">Planifications ({{ lineSummaryStats().planifications.length }})</h4>
            <div class="space-y-2 max-h-40 overflow-y-auto">
              <div *ngFor="let plan of lineSummaryStats().planifications.slice(0, 5)" 
                   class="p-2 bg-gray-700/30 rounded text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-300">{{ plan.jour }}</span>
                  <span class="text-green-300">{{ plan.reference }}</span>
                  <span class="text-cyan-300">{{ plan.qtePlanifiee }} unit√©s</span>
                </div>
              </div>
              <div *ngIf="lineSummaryStats().planifications.length > 5" class="text-center text-gray-400 text-sm">
                + {{ lineSummaryStats().planifications.length - 5 }} autres...
              </div>
            </div>
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="flex gap-4">
          <button 
            type="button" 
            (click)="onCancelLineSummary()"
            class="flex-1 py-4 rounded-xl font-semibold transition-all duration-300 bg-gray-600 hover:bg-gray-500 text-white">
            Annuler
          </button>
          
          <button 
            type="submit" 
            [disabled]="loading() || !downloadLineSummaryForm.semaine.trim() || !downloadLineSummaryForm.ligne.trim()"
            class="flex-1 submit-btn py-4 rounded-xl font-semibold transition-all duration-300 bg-amber-600 hover:bg-amber-500 text-white disabled:opacity-50 disabled:cursor-not-allowed">
            <span class="flex items-center justify-center">
              <span *ngIf="loading()" class="loader-small mr-2"></span>
              {{ loading() ? 'G√©n√©ration en cours...' : 
                 'üìä T√©l√©charger R√©sum√©' }}
              <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

    <!-- Onglet: Cr√©er une ligne -->
    <div *ngIf="activeTab() === 'create'" class="fade-in">
      <div class="max-w-2xl mx-auto">
        <div class="creation-card">
          <h2 class="text-2xl font-bold text-green-400 mb-6">Cr√©er une Nouvelle Ligne</h2>
          
          <form (ngSubmit)="onCreateLine()" class="space-y-6">
            <!-- Nom de la ligne -->
            <div>
              <label class="form-label">Nom de la Ligne *</label>
              <input 
                type="text" 
                [(ngModel)]="createForm.ligne" 
                name="ligne"
                placeholder="Ex: Ligne A - Assemblage Principal"
                class="form-input"
                [class.error]="createForm.errors.ligne">
              <div *ngIf="createForm.errors.ligne" class="form-error">
                {{ createForm.errors.ligne }}
              </div>
            </div>

            <!-- R√©f√©rences -->
            <div>
              <label class="form-label">R√©f√©rences *</label>
              <textarea 
                [(ngModel)]="createForm.references" 
                name="references"
                placeholder="Saisissez les r√©f√©rences s√©par√©es par des virgules&#10;Ex: REF-A001, REF-A002, REF-A003"
                rows="4"
                class="form-input"
                [class.error]="createForm.errors.references"></textarea>
              <div *ngIf="createForm.errors.references" class="form-error">
                {{ createForm.errors.references }}
              </div>
              <div class="text-sm text-gray-400 mt-1">
                S√©parez les r√©f√©rences par des virgules
              </div>
            </div>

            <!-- Upload d'image -->
            <div>
              <label class="form-label">Image de la Ligne</label>
              <div class="image-upload-container">
                <input 
                  type="file" 
                  (change)="onImageSelected($event)"
                  accept="image/*"
                  class="hidden"
                  id="imageUpload">
                <label for="imageUpload" class="upload-label">
                  <svg class="w-8 h-8 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 002 2z"/>
                  </svg>
                  Choisir une image
                </label>
                
                <!-- Aper√ßu de l'image -->
                <div *ngIf="createForm.imagePreview" class="image-preview">
                  <img [src]="createForm.imagePreview" alt="Aper√ßu" class="preview-image">
                  <button 
                    type="button" 
                    (click)="removeImage()"
                    class="remove-image-btn">
                    √ó
                  </button>
                </div>
              </div>
              <div *ngIf="createForm.errors.image" class="form-error">
                {{ createForm.errors.image }}
              </div>
            </div>

            <!-- Bouton de soumission -->
            <button 
              type="submit" 
              [disabled]="loading()"
              class="submit-btn create-btn w-full py-4 rounded-xl font-semibold transition-all duration-300"
              [class.opacity-50]="loading()">
              <span class="flex items-center justify-center">
                <span *ngIf="loading()" class="loader-small mr-2"></span>
                {{ loading() ? 'Cr√©ation en cours...' : 'Cr√©er la Ligne' }}
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
              </span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Onglet: Ajouter des r√©f√©rences -->
   <!-- Onglet: Ajouter des r√©f√©rences -->
<div *ngIf="activeTab() === 'add-ref'" class="fade-in">
  <div class="max-w-2xl mx-auto">
    <div class="creation-card">
      <h2 class="text-2xl font-bold text-blue-400 mb-6">Ajouter des R√©f√©rences √† une Ligne Existante</h2>
      
      <form (ngSubmit)="onAddReferences()" class="space-y-6">
        <!-- S√©lection de la ligne existante -->
        <div>
          <label class="form-label">S√©lectionner une Ligne *</label>
          
          <!-- Indicateur de chargement -->
          <div *ngIf="loading() && lines().length === 0" class="text-center py-4">
            <div class="loader-small mx-auto"></div>
            <p class="text-gray-400 mt-2">Chargement des lignes...</p>
          </div>
          
          <!-- Liste d√©roulante des lignes -->
          <select 
            [(ngModel)]="addRefForm.selectedLine" 
            name="selectedLine"
            class="form-input"
            [class.error]="addRefForm.errors.selectedLine"
            [disabled]="lines().length === 0">
            
            <option value="" disabled selected>
              {{ lines().length === 0 ? 'Chargement...' : 'S√©lectionnez une ligne' }}
            </option>
            
            <!-- Regrouper par premi√®res lettres -->
            <ng-container *ngFor="let lineGroup of getGroupedLines()">
              <optgroup *ngIf="lineGroup.lines.length > 0" [label]="lineGroup.group">
                <option *ngFor="let line of lineGroup.lines" [value]="line.ligne">
                  {{ line.ligne }} ({{ line.references.length || 0 }} r√©f√©rences)
                </option>
              </optgroup>
            </ng-container>
          </select>
          
          <div *ngIf="addRefForm.errors.selectedLine" class="form-error">
            {{ addRefForm.errors.selectedLine }}
          </div>
          
          <!-- Aper√ßu de la ligne s√©lectionn√©e -->
          <div *ngIf="addRefForm.selectedLine && getSelectedLineDetails()" class="mt-4 p-4 bg-gray-700/50 rounded-xl">
            <div class="flex items-start space-x-4">
              <!-- Image de la ligne -->
              <div class="w-16 h-16 flex-shrink-0">
                <img 
                  [src]="getSelectedLineDetails()?.imageUrl" 
                  [alt]="getSelectedLineDetails()?.ligne"
                  class="w-full h-full object-cover rounded-lg">
              </div>
              
              <!-- D√©tails -->
              <div class="flex-1">
                <h4 class="font-semibold text-white">{{ getSelectedLineDetails()?.ligne }}</h4>
                <div class="text-sm text-gray-300 mt-1">
                  <span class="text-cyan-400">{{ getSelectedLineDetails()?.references?.length || 0 }} r√©f√©rences existantes</span>
                </div>
                
                <!-- R√©f√©rences existantes (afficher seulement les 5 premi√®res) -->
                <div *ngIf="getSelectedLineDetails()?.references && getSelectedLineDetails()!.references.length > 0" 
                     class="mt-2">
                  <div class="text-xs text-gray-400 mb-1">R√©f√©rences actuelles :</div>
                  <div class="flex flex-wrap gap-1">
                    <span *ngFor="let ref of getSelectedLineDetails()!.references.slice(0, 5)" 
                          class="px-2 py-1 bg-gray-600/50 rounded text-xs text-gray-300">
                      {{ ref }}
                    </span>
                    <span *ngIf="getSelectedLineDetails()!.references.length > 5" 
                          class="px-2 py-1 bg-gray-600/30 rounded text-xs text-gray-400">
                      +{{ getSelectedLineDetails()!.references.length - 5 }} plus
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Message si pas de lignes -->
          <div *ngIf="!loading() && lines().length === 0" class="mt-4 p-4 bg-yellow-900/20 border border-yellow-700/30 rounded-xl">
            <div class="flex items-center text-yellow-300">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.998-.833-2.732 0L4.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
              </svg>
              <span>Aucune ligne disponible. Cr√©ez d'abord une ligne.</span>
            </div>
            <button 
              type="button"
              (click)="setActiveTab('create')"
              class="mt-2 px-4 py-2 bg-yellow-600 hover:bg-yellow-500 text-white rounded-lg text-sm transition-all duration-300">
              Cr√©er une nouvelle ligne
            </button>
          </div>
        </div>

        <!-- Nouvelles r√©f√©rences -->
        <div>
          <label class="form-label">Nouvelles R√©f√©rences √† Ajouter *</label>
          <textarea 
            [(ngModel)]="addRefForm.references" 
            name="references"
            placeholder="Saisissez les nouvelles r√©f√©rences s√©par√©es par des virgules&#10;Ex: REF-A006, REF-A007, REF-A008"
            rows="4"
            class="form-input"
            [class.error]="addRefForm.errors.references"
            [disabled]="lines().length === 0"></textarea>
          <div *ngIf="addRefForm.errors.references" class="form-error">
            {{ addRefForm.errors.references }}
          </div>
          <div class="text-sm text-gray-400 mt-1">
            S√©parez les r√©f√©rences par des virgules, points-virgules ou retours √† la ligne
          </div>
        </div>

        <!-- Bouton de soumission -->
        <button 
          type="submit" 
          [disabled]="loading() || lines().length === 0"
          class="submit-btn add-ref-btn w-full py-4 rounded-xl font-semibold transition-all duration-300"
          [class.opacity-50]="loading()"
          [class.cursor-not-allowed]="lines().length === 0">
          <span class="flex items-center justify-center">
            <span *ngIf="loading()" class="loader-small mr-2"></span>
            {{ loading() ? 'Ajout en cours...' : 
               lines().length === 0 ? 'Aucune ligne disponible' : 'Ajouter les R√©f√©rences' }}
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
          </span>
        </button>
      </form>
    </div>
  </div>
</div>

    <!-- Onglet: Nouvelle Semaine -->
    <!-- Onglet: Nouvelle Semaine -->
<div *ngIf="activeTab() === 'new-week'" class="fade-in">
  <div class="max-w-2xl mx-auto">
    <div class="creation-card">
      <h2 class="text-2xl font-bold text-purple-400 mb-6">Cr√©er une Nouvelle Semaine</h2>
      
      <form (ngSubmit)="onCreateWeek()" class="space-y-6">
        <!-- Nom de la semaine -->
        <div>
  <label class="form-label">Nom de la Semaine *</label>
  
  <!-- S√©lection des semaines -->
  <select 
    [(ngModel)]="weekForm.nom" 
    name="nom"
    class="form-input"
    [class.error]="weekForm.errors.nom">
    
    <option value="" disabled selected>S√©lectionnez une semaine</option>
    
    <!-- G√©n√©rer les options de semaine1 √† semaine52 -->
    <option *ngFor="let week of getWeeksList()" [value]="week">
      {{ week }}
    </option>
    
  </select>
  
  <div *ngIf="weekForm.errors.nom" class="form-error">
    {{ weekForm.errors.nom }}
  </div>
  
  <!-- Aper√ßu de la semaine s√©lectionn√©e -->
  <div *ngIf="weekForm.nom" class="mt-3 p-3 bg-gray-700/30 rounded-xl border border-purple-500/30">
    <div class="flex items-center">
      <svg class="w-5 h-5 text-purple-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
      </svg>
      <div>
        <span class="text-sm text-gray-400">Semaine s√©lectionn√©e :</span>
        <div class="font-semibold text-purple-400">{{ weekForm.nom }}</div>
      </div>
    </div>
  </div>
  
  <div class="text-sm text-gray-400 mt-1">
    S√©lectionnez une semaine de 1 √† 52
  </div>
</div>

        <!-- Date de d√©but -->
        <div>
          <label class="form-label">Date de d√©but *</label>
          <input 
            type="date" 
            [(ngModel)]="weekForm.dateDebut" 
            name="dateDebut"
            class="form-input"
            [class.error]="weekForm.errors.dateDebut">
          <div *ngIf="weekForm.errors.dateDebut" class="form-error">
            {{ weekForm.errors.dateDebut }}
          </div>
        </div>

        <!-- Date de fin -->
        <div>
          <label class="form-label">Date de fin *</label>
          <input 
            type="date" 
            [(ngModel)]="weekForm.dateFin" 
            name="dateFin"
            class="form-input"
            [class.error]="weekForm.errors.dateFin">
          <div *ngIf="weekForm.errors.dateFin" class="form-error">
            {{ weekForm.errors.dateFin }}
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="flex gap-4">
          <button 
            type="button" 
            (click)="onCancelWeek()"
            class="flex-1 py-4 rounded-xl font-semibold transition-all duration-300 bg-gray-600 hover:bg-gray-500 text-white">
            Annuler
          </button>
          <button 
            type="submit" 
            [disabled]="loading()"
            class="flex-1 submit-btn py-4 rounded-xl font-semibold transition-all duration-300 bg-purple-600 hover:bg-purple-500 text-white"
            [class.opacity-50]="loading()">
            <span class="flex items-center justify-center">
              <span *ngIf="loading()" class="loader-small mr-2"></span>
              {{ loading() ? 'Cr√©ation...' : 'Cr√©er la Semaine' }}
              <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
    <!-- Onglet: Ajouter Utilisateur -->
    <div *ngIf="activeTab() === 'add-user'" class="fade-in">
      <div class="max-w-4xl mx-auto">
        <!-- Formulaire d'ajout -->
        <div class="creation-card mb-8">
          <h2 class="text-2xl font-bold text-indigo-400 mb-6">Ajouter un Utilisateur</h2>
          
          <form (ngSubmit)="onAddUser()" class="space-y-6">
            <!-- Nom d'utilisateur -->
            <div>
              <label class="form-label">Nom d'Utilisateur *</label>
              <input 
                type="text" 
                [(ngModel)]="userForm.nom" 
                name="nom"
                placeholder="Ex: 1234 (4-10 chiffres)"
                class="form-input"
                [class.error]="userForm.errors.nom">
              <div *ngIf="userForm.errors.nom" class="form-error">
                {{ userForm.errors.nom }}
              </div>
            </div>

            <!-- Pr√©nom -->
            <div>
              <label class="form-label">Pr√©nom *</label>
              <input 
                type="text" 
                [(ngModel)]="userForm.prenom" 
                name="prenom"
                placeholder="Ex: Jean (max 50 caract√®res)"
                class="form-input"
                [class.error]="userForm.errors.prenom">
              <div *ngIf="userForm.errors.prenom" class="form-error">
                {{ userForm.errors.prenom }}
              </div>
            </div>

            <!-- Mot de passe -->
            <div>
              <label class="form-label">Mot de Passe *</label>
              <input 
                type="password" 
                [(ngModel)]="userForm.password" 
                name="password"
                placeholder="Ex: 123456 (4-10 chiffres)"
                class="form-input"
                [class.error]="userForm.errors.password">
              <div *ngIf="userForm.errors.password" class="form-error">
                {{ userForm.errors.password }}
              </div>
            </div>

            <!-- Boutons d'action -->
            <div class="flex gap-4">
              <button 
                type="button" 
                (click)="onCancelUser()"
                class="flex-1 py-4 rounded-xl font-semibold transition-all duration-300 bg-gray-600 hover:bg-gray-500 text-white">
                Annuler
              </button>
              <button 
                type="submit" 
                [disabled]="loading()"
                class="flex-1 submit-btn py-4 rounded-xl font-semibold transition-all duration-300 bg-indigo-600 hover:bg-indigo-500 text-white"
                [class.opacity-50]="loading()">
                <span class="flex items-center justify-center">
                  <span *ngIf="loading()" class="loader-small mr-2"></span>
                  {{ loading() ? 'Ajout en cours...' : 'Ajouter l\'Utilisateur' }}
                  <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                  </svg>
                </span>
              </button>
            </div>
          </form>
        </div>

        <!-- Liste des utilisateurs -->
        <div class="creation-card">
          <h3 class="text-xl font-bold text-indigo-400 mb-6">Liste des Utilisateurs</h3>
          
          <div class="space-y-4">
            <div *ngFor="let user of users()" 
                 class="bg-gray-700/50 rounded-xl p-4 flex items-center justify-between hover:bg-gray-700/70 transition-all duration-300">
              <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-indigo-600/30 rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                </div>
                <div>
                  <div class="font-semibold text-white">{{ user.nom }} {{ user.prenom }}</div>
                  <div class="text-sm text-gray-400">
                    {{ user.isActive ? '‚úÖ Actif' : '‚ùå Inactif' }}
                    <span *ngIf="user.createdAt" class="ml-2">
                      ‚Ä¢ Cr√©√© le {{ user.createdAt | date:'dd/MM/yyyy' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Message vide -->
            <div *ngIf="users().length === 0" class="text-center py-8 text-gray-400">
              Aucun utilisateur trouv√©
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Onglet: Ajouter Temps par Seconde -->
    <!-- Onglet: Ajouter Temps par Seconde -->
<!-- Onglet: Ajouter Temps par Seconde -->
<div *ngIf="activeTab() === 'add-time'" class="fade-in">
  <div class="max-w-2xl mx-auto">
    <div class="creation-card">
      <h2 class="text-2xl font-bold text-yellow-400 mb-6">D√©finir le Temps par Seconde</h2>
      <p class="text-gray-400 mb-6">D√©finir ou modifier le temps de production pour une r√©f√©rence sp√©cifique</p>
      
      <form (ngSubmit)="onAddTime()" class="space-y-6">
        <!-- S√©lection de la ligne -->
        <div>
          <label class="form-label">S√©lectionner une Ligne *</label>
          
          <!-- Indicateur de chargement -->
          <div *ngIf="loading() && lines().length === 0" class="text-center py-4">
            <div class="loader-small mx-auto"></div>
            <p class="text-gray-400 mt-2">Chargement des lignes...</p>
          </div>
          
          <!-- Liste d√©roulante des lignes -->
          <select 
            [(ngModel)]="timeForm.selectedLine" 
            name="selectedLine"
            (change)="onLineSelectedForTime()"
            class="form-input"
            [class.error]="timeForm.errors.selectedLine"
            [disabled]="lines().length === 0">
            
            <option value="" disabled selected>
              {{ lines().length === 0 ? 'Chargement...' : 'S√©lectionnez une ligne' }}
            </option>
            
            <!-- Regrouper par premi√®res lettres -->
            <ng-container *ngFor="let lineGroup of getGroupedLines()">
              <optgroup *ngIf="lineGroup.lines.length > 0" [label]="lineGroup.group">
                <option *ngFor="let line of lineGroup.lines" [value]="line.ligne">
                  {{ line.ligne }} ({{ line.references.length || 0 }} r√©f√©rences)
                </option>
              </optgroup>
            </ng-container>
          </select>
          
          <div *ngIf="timeForm.errors.selectedLine" class="form-error">
            {{ timeForm.errors.selectedLine }}
          </div>
        </div>

        <!-- S√©lection de la r√©f√©rence (d√©pend de la ligne) -->
        <div>
          <label class="form-label">S√©lectionner une R√©f√©rence *</label>
          
          <select 
            [(ngModel)]="timeForm.selectedReference" 
            name="selectedReference"
            (change)="loadExistingTimeForReference()"
            class="form-input"
            [class.error]="timeForm.errors.selectedReference"
            [disabled]="!timeForm.selectedLine || getAvailableReferences().length === 0">
            
            <option value="" disabled selected>
              {{ !timeForm.selectedLine ? 'S√©lectionnez d\'abord une ligne' : 
                 getAvailableReferences().length === 0 ? 'Aucune r√©f√©rence disponible' : 
                 'S√©lectionnez une r√©f√©rence' }}
            </option>
            
            <option *ngFor="let ref of getAvailableReferences()" [value]="ref">
              {{ ref }}
            </option>
          </select>
          
          <div *ngIf="timeForm.errors.selectedReference" class="form-error">
            {{ timeForm.errors.selectedReference }}
          </div>
          
          <!-- Aper√ßu de la r√©f√©rence s√©lectionn√©e -->
          <div *ngIf="timeForm.selectedReference" class="mt-3 p-3 bg-gray-700/30 rounded-lg">
            <div class="flex items-center text-sm text-gray-300">
              <svg class="w-4 h-4 mr-2 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span>R√©f√©rence s√©lectionn√©e : <span class="font-semibold text-yellow-300">{{ timeForm.selectedReference }}</span></span>
            </div>
          </div>
          
          <!-- Message si aucune r√©f√©rence -->
          <div *ngIf="timeForm.selectedLine && getAvailableReferences().length === 0" 
               class="mt-3 p-3 bg-yellow-900/20 border border-yellow-700/30 rounded-lg">
            <div class="flex items-center text-yellow-300 text-sm">
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.998-.833-2.732 0L4.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
              </svg>
              <span>Cette ligne n'a pas encore de r√©f√©rences.</span>
            </div>
            <button 
              type="button"
              (click)="addRefForm.selectedLine = timeForm.selectedLine; setActiveTab('add-ref')"
              class="mt-2 px-3 py-1.5 bg-yellow-600 hover:bg-yellow-500 text-white rounded-lg text-xs transition-all duration-300">
              Ajouter des r√©f√©rences √† cette ligne
            </button>
          </div>
        </div>

        <!-- Temps en secondes -->
        <div>
          <label class="form-label">Temps par Seconde *</label>
          <div class="relative">
            <input 
              type="number" 
              [(ngModel)]="timeForm.seconde" 
              name="seconde"
              placeholder="Ex: 120"
              min="0.1"
              step="0.1"
              class="form-input pl-12"
              [class.error]="timeForm.errors.seconde"
              [disabled]="!timeForm.selectedReference">
            <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
          </div>
          <div *ngIf="timeForm.errors.seconde" class="form-error">
            {{ timeForm.errors.seconde }}
          </div>
          
          <!-- Aide pour le temps -->
          <div class="mt-2 space-y-2">
            <div class="text-sm text-gray-400">
              <span class="font-medium text-yellow-400">Explications :</span> Temps n√©cessaire pour produire 1 unit√©
            </div>
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="flex gap-4">
          <button 
            type="button" 
            (click)="onCancelTime()"
            class="flex-1 py-4 rounded-xl font-semibold transition-all duration-300 bg-gray-600 hover:bg-gray-500 text-white">
            Annuler
          </button>
          <button 
            type="submit" 
            [disabled]="loading() || !timeForm.selectedLine || !timeForm.selectedReference"
            class="flex-1 submit-btn py-4 rounded-xl font-semibold transition-all duration-300 bg-yellow-600 hover:bg-yellow-500 text-white disabled:opacity-50 disabled:cursor-not-allowed">
            <span class="flex items-center justify-center">
              <span *ngIf="loading()" class="loader-small mr-2"></span>
              {{ loading() ? 'Sauvegarde...' : 
                 !timeForm.selectedLine || !timeForm.selectedReference ? 'S√©lectionnez ligne et r√©f√©rence' : 
                 'D√©finir le Temps' }}
              <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

    <!-- Onglet: Ajouter Ouvrier -->
    <!-- Dans la section "Ajouter Ouvrier" du template -->
<div *ngIf="activeTab() === 'add-worker'" class="fade-in">
  <div class="max-w-2xl mx-auto">
    <div class="creation-card">
      <h2 class="text-2xl font-bold text-pink-400 mb-6">Ajouter un Nouvel Ouvrier</h2>
      
      <!-- Message d'erreur g√©n√©ral -->
      <div *ngIf="errorMessage()" class="mb-6 p-4 bg-red-900/30 border border-red-700 rounded-xl">
        <div class="flex items-start">
          <svg class="w-6 h-6 text-red-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <div>
            <p class="text-gray-900 font-bold">{{ errorMessage() }}</p>
            <p class="text-gray-800 text-sm mt-1">Veuillez v√©rifier le matricule et r√©essayer.</p>
          </div>
        </div>
      </div>
      
      <form (ngSubmit)="onAddWorker()" class="space-y-6">
        <!-- Matricule avec v√©rification -->
        <div>
          <label class="form-label">Matricule *</label>
          <div class="flex gap-2">
            <input 
              type="number" 
              [(ngModel)]="workerForm.matricule" 
              name="matricule"
              placeholder="Ex: 1001"
              min="1"
              max="999999"
              class="form-input flex-1"
              [class.error]="workerForm.errors.matricule"
              (blur)="onCheckMatricule()">
            
            <button 
              type="button"
              (click)="onCheckMatricule()"
              [disabled]="!workerForm.matricule"
              class="px-4 py-3 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-xl font-medium transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
              <span class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                V√©rifier
              </span>
            </button>
          </div>
          
          <div *ngIf="workerForm.errors.matricule" class="form-error">
            {{ workerForm.errors.matricule }}
          </div>
          
          <!-- Indicateur de disponibilit√© du matricule -->
          <div *ngIf="matriculeCheckResult" class="mt-3">
            <div [ngClass]="{
              'bg-green-900/30 border-green-700': matriculeCheckResult.available,
              'bg-red-900/30 border-red-700': !matriculeCheckResult.available
            }" class="p-3 rounded-lg border">
              <div class="flex items-center">
                <svg *ngIf="matriculeCheckResult.available" class="w-5 h-5 text-green-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <svg *ngIf="!matriculeCheckResult.available" class="w-5 h-5 text-red-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span [ngClass]="{
                  'text-green-300': matriculeCheckResult.available,
                  'text-gray-900': !matriculeCheckResult.available
                }">
                  {{ matriculeCheckResult.message }}
                </span>
              </div>
              
              <!-- D√©tails si ouvrier existe d√©j√† -->
              <div *ngIf="!matriculeCheckResult.available && matriculeCheckResult.existingWorker" 
                   class="mt-2 pl-7">
                <div class="text-sm">
                  <div class="text-gray-900 font-bold">
                    <span class="font-medium">Ouvrier existant :</span> 
                    {{ matriculeCheckResult.existingWorker.nomPrenom }}
                  </div>
                  <button 
                    type="button"
                    (click)="suggestDifferentMatricule()"
                    class="mt-1 text-xs text-pink-300 hover:text-pink-200 underline">
                    Sugg√©rer un autre matricule
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Nom et Pr√©nom -->
        <div>
          <label class="form-label">Nom et Pr√©nom *</label>
          <input 
            type="text" 
            [(ngModel)]="workerForm.nomPrenom" 
            name="nomPrenom"
            placeholder="Ex: DUPONT Jean"
            class="form-input"
            [class.error]="workerForm.errors.nomPrenom">
          <div *ngIf="workerForm.errors.nomPrenom" class="form-error">
            {{ workerForm.errors.nomPrenom }}
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="flex gap-4">
          <button 
            type="button" 
            (click)="onCancelWorker()"
            class="flex-1 py-4 rounded-xl font-semibold transition-all duration-300 bg-gray-600 hover:bg-gray-500 text-white">
            Annuler
          </button>
          <button 
            type="submit" 
            [disabled]="loading() || (matriculeCheckResult && !matriculeCheckResult.available)"
            class="flex-1 submit-btn py-4 rounded-xl font-semibold transition-all duration-300 bg-pink-600 hover:bg-pink-500 text-white disabled:opacity-50 disabled:cursor-not-allowed">
            <span class="flex items-center justify-center">
              <span *ngIf="loading()" class="loader-small mr-2"></span>
              {{ loading() ? 'Ajout en cours...' : 
                 (matriculeCheckResult && !matriculeCheckResult.available) ? 'Matricule d√©j√† utilis√©' : 
                 'Ajouter l\'Ouvrier' }}
              <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

    <!-- Onglet: Ajouter Phase -->
    <!-- Onglet: Gestion des Phases -->
<div *ngIf="activeTab() === 'add-phase'" class="fade-in">
  <div class="max-w-4xl mx-auto">
    <!-- Mode s√©lection -->
    <div class="creation-card mb-6">
      <div class="flex space-x-4 mb-6">
        <button 
          (click)="setPhaseMode('add')"
          class="flex-1 py-3 rounded-xl font-semibold transition-all duration-300"
          [class]="phaseForm.mode === 'add' ? 
                   'bg-teal-600 text-white shadow-lg shadow-teal-600/25' : 
                   'bg-gray-700 text-gray-300 hover:text-white hover:bg-gray-600'">
          <span class="flex items-center justify-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            Ajouter une Nouvelle Phase
          </span>
        </button>
        
        <button 
          (click)="setPhaseMode('edit')"
          class="flex-1 py-3 rounded-xl font-semibold transition-all duration-300"
          [class]="phaseForm.mode === 'edit' ? 
                   'bg-blue-600 text-white shadow-lg shadow-blue-600/25' : 
                   'bg-gray-700 text-gray-300 hover:text-white hover:bg-gray-600'">
          <span class="flex items-center justify-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
            </svg>
            Modifier une Phase Existante
          </span>
        </button>
      </div>
    </div>

    <!-- Formulaire selon le mode -->
    <div class="creation-card">
      <h2 class="text-2xl font-bold text-teal-400 mb-6">
        {{ phaseForm.mode === 'add' ? 'Ajouter une Nouvelle Phase' : 'Modifier une Phase Existante' }}
      </h2>
      
      <!-- Message d'erreur g√©n√©ral -->
      <div *ngIf="errorMessage()" class="mb-6 p-4 bg-red-900/30 border border-red-700 rounded-xl">
        <div class="flex items-start">
          <svg class="w-6 h-6 text-red-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <div>
            <p class="text-red-300 font-medium">{{ errorMessage() }}</p>
          </div>
        </div>
      </div>
      
      <form (ngSubmit)="onAddPhase()" class="space-y-6">
        <!-- S√©lection de la ligne -->
        <div>
          <label class="form-label">Ligne *</label>
          
          <select 
            [(ngModel)]="phaseForm.selectedLine" 
            name="selectedLine"
            class="form-input"
            [class.error]="phaseForm.errors.selectedLine"
            [disabled]="lines().length === 0">
            
            <option value="" disabled selected>
              {{ lines().length === 0 ? 'Chargement...' : 'S√©lectionnez une ligne' }}
            </option>
            
            <option *ngFor="let line of lines()" [value]="line.ligne">
              {{ line.ligne }} ({{ line.references.length || 0 }} r√©f√©rences)
            </option>
          </select>
          
          <div *ngIf="phaseForm.errors.selectedLine" class="form-error">
            {{ phaseForm.errors.selectedLine }}
          </div>
        </div>

        <!-- Num√©ro de phase -->
        <div>
          <label class="form-label">
            Num√©ro de Phase *
            <span *ngIf="phaseForm.mode === 'edit' && selectedPhaseForEdit" class="text-sm text-gray-400 ml-2">
              (Actuel: {{ selectedPhaseForEdit.phase }})
            </span>
          </label>
          
          <input 
            type="text" 
            [(ngModel)]="phaseForm.phase" 
            name="phase"
            [placeholder]="phaseForm.mode === 'add' ? 'Ex: 1, 2, 3...' : 'Nouveau num√©ro de phase'"
            class="form-input"
            [class.error]="phaseForm.errors.phase"
            maxlength="10">
          
          <div *ngIf="phaseForm.errors.phase" class="form-error">
            {{ phaseForm.errors.phase }}
          </div>
          
          <!-- V√©rification en temps r√©el -->
          <div *ngIf="phaseForm.selectedLine && phaseForm.phase.trim() && phaseForm.mode === 'add'" class="mt-3">
            <div *ngIf="checkIfPhaseExists()" class="p-3 bg-yellow-900/30 border border-yellow-700 rounded-lg">
              <div class="flex items-center text-yellow-300">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.998-.833-2.732 0L4.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                </svg>
                <span>Cette phase existe d√©j√† pour cette ligne</span>
              </div>
            </div>
            
            <div *ngIf="!checkIfPhaseExists()" class="p-3 bg-green-900/30 border border-green-700 rounded-lg">
              <div class="flex items-center text-green-300">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span>Cette phase peut √™tre ajout√©e</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Section pour modifier une phase existante -->
        <div *ngIf="phaseForm.mode === 'edit' && phaseForm.selectedLine" class="mt-6">
          <h3 class="text-lg font-semibold text-blue-400 mb-4">
            Phases existantes pour "{{ phaseForm.selectedLine }}"
          </h3>
          
          <!-- Chargement -->
          <div *ngIf="loading() && phases().length === 0" class="text-center py-8">
            <div class="loader-small mx-auto"></div>
            <p class="text-gray-400 mt-2">Chargement des phases...</p>
          </div>
          
          <!-- Liste des phases -->
          <div *ngIf="getPhasesForSelectedLine().length > 0" class="space-y-3">
            <div *ngFor="let phase of getPhasesForSelectedLine()" 
                 class="flex items-center justify-between p-4 bg-gray-700/30 rounded-xl hover:bg-gray-700/50 transition-all duration-300"
                 [class.border-2]="selectedPhaseForEdit?.id === phase.id"
                 [class.border-blue-500]="selectedPhaseForEdit?.id === phase.id">
              
              <div class="flex items-center space-x-4">
                <div class="w-10 h-10 bg-blue-600/30 rounded-full flex items-center justify-center">
                  <span class="text-blue-300 font-bold">{{ phase.phase }}</span>
                </div>
                <div>
                  <div class="text-white font-medium">Phase {{ phase.phase }}</div>
                  <div class="text-sm text-gray-400">
                    Ligne: {{ phase.ligne }}
                    <span *ngIf="phase.createdAt" class="ml-2">
                      ‚Ä¢ Cr√©√©e le {{ phase.createdAt | date:'dd/MM/yyyy' }}
                    </span>
                  </div>
                </div>
              </div>
              
              <div class="flex space-x-2">
                <button 
                  type="button"
                  (click)="selectPhaseForEdit(phase)"
                  class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm transition-all duration-300 flex items-center">
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                  Modifier
                </button>
                
                <button 
                  type="button"
                  (click)="onDeletePhase(phase.id)"
                  class="px-4 py-2 bg-red-600/20 hover:bg-red-600/30 text-red-300 rounded-lg text-sm transition-all duration-300 flex items-center">
                  <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                  Supprimer
                </button>
              </div>
            </div>
          </div>
          
          <!-- Message si pas de phases -->
          <div *ngIf="!loading() && getPhasesForSelectedLine().length === 0" 
               class="p-6 text-center border-2 border-dashed border-gray-600 rounded-xl">
            <svg class="w-12 h-12 text-gray-500 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
            </svg>
            <p class="text-gray-400">Aucune phase existante pour cette ligne</p>
            <p class="text-gray-500 text-sm mt-1">Utilisez le mode "Ajouter" pour cr√©er une nouvelle phase</p>
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="flex gap-4 pt-6 border-t border-gray-700">
          <button 
            type="button" 
            (click)="onCancelPhase()"
            class="flex-1 py-4 rounded-xl font-semibold transition-all duration-300 bg-gray-600 hover:bg-gray-500 text-white">
            Annuler
          </button>
          
          <button 
            type="submit" 
            [disabled]="loading() || 
                       !phaseForm.selectedLine || 
                       !phaseForm.phase.trim() ||
                       (phaseForm.mode === 'add' && checkIfPhaseExists()) ||
                       (phaseForm.mode === 'edit' && !selectedPhaseForEdit)"
            class="flex-1 submit-btn py-4 rounded-xl font-semibold transition-all duration-300"
            [class]="phaseForm.mode === 'add' ? 
                     'bg-teal-600 hover:bg-teal-500 text-white' : 
                     'bg-blue-600 hover:bg-blue-500 text-white'"
            [class.opacity-50]="loading()"
            [class.cursor-not-allowed]="!phaseForm.selectedLine || !phaseForm.phase.trim()">
            
            <span class="flex items-center justify-center">
              <span *ngIf="loading()" class="loader-small mr-2"></span>
              {{ loading() ? 'Traitement...' : 
                 phaseForm.mode === 'add' ? 'Ajouter la Phase' : 'Modifier la Phase' }}
              <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M5 13l4 4L19 7"/>
              </svg>
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

  </div>

  <!-- Modal de d√©tails -->
  <div *ngIf="selectedLine()" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">{{ selectedLine()!.ligne }}</h3>
        <button (click)="closeModal()" class="modal-close">
          √ó
        </button>
      </div>
       
      <div class="modal-body">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Image -->
          <div>
            <img 
              [src]="selectedLine()!.imageUrl || 'https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=400'"
              [alt]="selectedLine()!.ligne"
              class="w-full h-64 object-cover rounded-xl">
              <div class="mt-4">
                <button 
                  (click)="openImageUpload()"
                  class="w-full px-4 py-3 rounded-xl font-semibold transition-all duration-300 bg-cyan-600 hover:bg-cyan-500 text-white flex items-center justify-center shadow-lg">
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 002 2z"/>
                  </svg>
                  Changer la photo de la ligne
                </button>
              </div>
          </div>
          
          <!-- Informations -->
          <div>
            <div class="space-y-4">
              <div>
                <h4 class="text-cyan-400 font-semibold mb-2">Statistiques</h4>
                <div class="grid grid-cols-2 gap-4">
                  <div class="stat-item">
                    <div class="stat-value">{{ selectedLine()!.referenceCount }}</div>
                    <div class="stat-label">R√©f√©rences</div>
                  </div>
                  <div class="stat-item">
                    <div class="stat-value">{{ selectedLine()!.lastCreated | date:'dd/MM/yyyy' }}</div>
                    <div class="stat-label">Derni√®re mise √† jour</div>
                  </div>
                </div>
              </div>
              
              <div>
                <h4 class="text-cyan-400 font-semibold mb-2">Toutes les R√©f√©rences</h4>
                <div class="references-grid">
                  <div *ngFor="let ref of selectedLine()!.references" class="reference-tag detailed">
                    {{ ref }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal pour upload d'image de ligne -->
  <div *ngIf="showImageUploadModal" class="modal-overlay" (click)="closeImageUploadModal()">
    <div class="modal-content max-w-md" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Changer la photo de {{ selectedLine()?.ligne }}</h3>
        <button (click)="closeImageUploadModal()" class="modal-close">
          √ó
        </button>
      </div>
      
      <div class="modal-body">
        <div class="space-y-6">
          <!-- Aper√ßu actuel -->
          <div *ngIf="selectedLine()">
            <label class="form-label">Photo actuelle</label>
            <img 
              [src]="selectedLine()!.imageUrl || 'https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=400'"
              [alt]="selectedLine()!.ligne"
              class="w-full h-48 object-cover rounded-lg border-2 border-gray-600">
          </div>
          
          <!-- Upload de nouvelle image -->
          <div>
            <label class="form-label">Nouvelle image</label>
            <div class="image-upload-container border-2 border-dashed border-gray-600 rounded-xl p-6 hover:border-cyan-500 transition-all duration-300">
              <input 
                type="file" 
                (change)="onLineImageSelected($event)"
                accept="image/*"
                class="hidden"
                id="lineImageUpload">
              <label for="lineImageUpload" class="upload-label cursor-pointer flex flex-col items-center justify-center text-gray-400 hover:text-cyan-400">
                <svg class="w-12 h-12 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 002 2z"/>
                </svg>
                <span class="font-medium">Cliquez pour choisir une image</span>
                <span class="text-sm mt-1">JPEG, PNG (max 5MB)</span>
              </label>
            </div>
            
            <!-- Aper√ßu de la nouvelle image -->
            <div *ngIf="lineImagePreview" class="mt-4">
              <label class="form-label">Aper√ßu de la nouvelle image</label>
              <div class="relative">
                <img [src]="lineImagePreview" alt="Nouvel aper√ßu" class="w-full h-48 object-cover rounded-lg border-2 border-cyan-500">
                <button 
                  type="button" 
                  (click)="selectedLineImage = null; lineImagePreview = null"
                  class="absolute top-2 right-2 w-8 h-8 bg-red-600 hover:bg-red-500 text-white rounded-full flex items-center justify-center">
                  √ó
                </button>
              </div>
            </div>
            
            <!-- Message d'erreur -->
            <div *ngIf="imageUploadError" class="mt-3 p-3 bg-red-900/30 border border-red-700 rounded-lg text-red-300 text-sm">
              {{ imageUploadError }}
            </div>
          </div>
          
          <!-- Boutons d'action -->
          <div class="flex gap-4 pt-4 border-t border-gray-700">
            <button 
              type="button" 
              (click)="closeImageUploadModal()"
              class="flex-1 py-3 rounded-xl font-semibold transition-all duration-300 bg-gray-700 hover:bg-gray-600 text-white">
              Annuler
            </button>
            <button 
              type="button" 
              (click)="uploadLineImage()"
              [disabled]="!selectedLineImage || loading()"
              class="flex-1 py-3 rounded-xl font-semibold transition-all duration-300 bg-cyan-600 hover:bg-cyan-500 text-white disabled:opacity-50 disabled:cursor-not-allowed">
              <span class="flex items-center justify-center">
                <span *ngIf="loading()" class="loader-small mr-2"></span>
                {{ loading() ? 'Envoi en cours...' : 'Mettre √† jour' }}
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Onglet: Voir les Statistiques (Admin seulement) -->
<div *ngIf="activeTab() === 'view-stats' && isAdmin()" class="fade-in">
  <div class="max-w-7xl mx-auto">
    <!-- Formulaire de s√©lection -->
    <div class="creation-card mb-8">
      <h2 class="text-2xl font-bold text-purple-400 mb-6">Voir les Statistiques</h2>
      <p class="text-gray-400 mb-6">S√©lectionnez une semaine et une ligne pour voir les graphiques statistiques</p>
      
      <!-- Message d'erreur -->
      <div *ngIf="errorMessage()" class="mb-6 p-4 bg-red-900/30 border border-red-700 rounded-xl">
        <div class="flex items-start">
          <svg class="w-6 h-6 text-red-400 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <div>
            <p class="text-red-300 font-medium">{{ errorMessage() }}</p>
          </div>
        </div>
      </div>
      
      <form (ngSubmit)="onViewStats()" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- S√©lection de la semaine -->
          <div>
  <label class="form-label">Semaine *</label>
  
  <!-- Bo√Æte de s√©lection des semaines -->
  <select 
    [(ngModel)]="statsForm.semaine" 
    name="semaine"
    class="form-input"
    [class.error]="statsForm.errors.semaine">
    
    <option value="" disabled selected>S√©lectionnez une semaine</option>
    
    <!-- G√©n√©rer les options de semaine1 √† semaine52 -->
    <option *ngFor="let week of getWeeksList()" [value]="week">
      {{ week }}
    </option>
    
  </select>
  
  <div *ngIf="statsForm.errors.semaine" class="form-error">
    {{ statsForm.errors.semaine }}
  </div>
  
  <!-- Aper√ßu de la semaine s√©lectionn√©e -->
  <div *ngIf="statsForm.semaine" class="mt-3 p-3 bg-gray-700/30 rounded-xl border border-purple-500/30">
    <div class="flex items-center">
      <svg class="w-5 h-5 text-purple-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
      </svg>
      <div>
        <span class="text-sm text-gray-400">Semaine s√©lectionn√©e :</span>
        <div class="font-semibold text-purple-400">{{ statsForm.semaine }}</div>
      </div>
    </div>
  </div>
</div>

          <!-- S√©lection de la ligne -->
          <div>
            <label class="form-label">Ligne *</label>
            <select 
              [(ngModel)]="statsForm.ligne" 
              name="ligne"
              class="form-input"
              [class.error]="statsForm.errors.ligne">
              <option value="" disabled selected>S√©lectionnez une ligne</option>
              <option *ngFor="let line of lines()" [value]="line.ligne">
                {{ line.ligne }}
              </option>
            </select>
            <div *ngIf="statsForm.errors.ligne" class="form-error">
              {{ statsForm.errors.ligne }}
            </div>
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="flex gap-4">
          <button 
            type="button" 
            (click)="onCancelStats()"
            class="flex-1 py-4 rounded-xl font-semibold transition-all duration-300 bg-gray-600 hover:bg-gray-500 text-white">
            Annuler
          </button>
          
          <button 
            type="submit" 
            [disabled]="loadingStatsData() || !statsForm.semaine.trim() || !statsForm.ligne.trim()"
            class="flex-1 submit-btn py-4 rounded-xl font-semibold transition-all duration-300 bg-purple-600 hover:bg-purple-500 text-white disabled:opacity-50 disabled:cursor-not-allowed">
            <span class="flex items-center justify-center">
              <span *ngIf="loadingStatsData()" class="loader-small mr-2"></span>
              {{ loadingStatsData() ? 'Chargement...' : 'üìà G√©n√©rer les Graphiques' }}
            </span>
          </button>
        </div>
      </form>
    </div>

    <!-- Section Graphiques -->
    <div *ngIf="statsData()" class="space-y-8">
      <!-- En-t√™te -->
      <div class="creation-card bg-gradient-to-r from-purple-600/10 to-indigo-600/10 border border-purple-500/30">
        <div class="flex justify-between items-center">
          <div>
            <h3 class="text-xl font-bold text-purple-400">
              Statistiques pour {{ statsData().periode?.ligne }} - {{ statsData().periode?.semaine }}
            </h3>
            <div class="text-sm text-gray-400 mt-1">
              G√©n√©r√© le {{ statsData().periode?.dateCalcul | date:'dd/MM/yyyy HH:mm' }}
            </div>
          </div>
          <div class="flex gap-2">
            <button 
              (click)="exportCharts()"
              class="px-4 py-2 bg-green-600 hover:bg-green-500 text-white rounded-lg flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
              Exporter
            </button>
          </div>
        </div>
      </div>

      <!-- Statistiques r√©sum√©es -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="stat-card bg-gradient-to-br from-blue-600/20 to-blue-800/20">
          <div class="text-2xl font-bold text-blue-400">{{ statsData().resumeGeneral?.pcsProdTotal || 0 }}%</div>
          <div class="text-blue-200 text-sm">PCS Prod Total</div>
        </div>
        <div class="stat-card bg-gradient-to-br from-red-600/20 to-red-800/20">
          <div class="text-2xl font-bold text-red-400">{{ statsData().resumeGeneral?.pourcentageTotalEcart || 0 }}%</div>
          <div class="text-red-200 text-sm">% √âcart Total</div>
        </div>
        <div class="stat-card bg-gradient-to-br from-green-600/20 to-green-800/20">
          <div class="text-2xl font-bold text-green-400">{{ statsData().resumeGeneral?.totalQteSource || 0 }}</div>
          <div class="text-green-200 text-sm">Qt√© Source</div>
        </div>
        <div class="stat-card bg-gradient-to-br from-yellow-600/20 to-yellow-800/20">
          <div class="text-2xl font-bold text-yellow-400">{{ statsData().resumeGeneral?.totalDecProduction || 0 }}</div>
          <div class="text-yellow-200 text-sm">D√©c. Production</div>
        </div>
      </div>

      <!-- Grille de graphiques -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Graphique 1: Quantit√©s -->
        <div class="creation-card">
          <div class="h-80">
            <canvas id="quantityChart"></canvas>
          </div>
        </div>

        <!-- Graphique 2: PCS Prod -->
        <div class="creation-card">
          <div class="h-80">
            <canvas id="pcsChart"></canvas>
          </div>
        </div>

        <!-- Graphique 3: R√©partition des √©carts -->
        <div class="creation-card">
          <div class="h-80">
            <canvas id="ecartPieChart"></canvas>
          </div>
        </div>

        <!-- Graphique 4: √âcarts par jour -->
        <div class="creation-card">
          <div class="h-80">
            <canvas id="ecartBarChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Graphique 5: Comparaison (pleine largeur) -->
      <div class="creation-card">
        <div class="h-96">
          <canvas id="comparisonChart"></canvas>
        </div>
      </div>

      <!-- Tableau de donn√©es -->
      <div class="creation-card">
        <h4 class="text-lg font-semibold text-cyan-400 mb-6">D√©tails des Donn√©es</h4>
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead>
              <tr class="bg-gray-700/50">
                <th class="p-3 text-left text-gray-300">Jour</th>
                <th class="p-3 text-left text-gray-300">R√©f√©rence</th>
                <th class="p-3 text-left text-gray-300">Qt√© Planifi√©e</th>
                <th class="p-3 text-left text-gray-300">Qt√© Modifi√©e</th>
                <th class="p-3 text-left text-gray-300">D√©c. Prod</th>
                <th class="p-3 text-left text-gray-300">PCS Prod</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let detail of statsData().details" 
                  class="border-b border-gray-700/30 hover:bg-gray-700/20">
                <td class="p-3 text-gray-300">{{ detail.jour }}</td>
                <td class="p-3 text-gray-300">{{ detail.reference }}</td>
                <td class="p-3 text-gray-300">{{ detail.qtePlanifiee }}</td>
                <td class="p-3 text-gray-300">{{ detail.qteModifiee }}</td>
                <td class="p-3 text-gray-300">{{ detail.decProduction }}</td>
                <td class="p-3 text-gray-300">{{ detail.pcsProd }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Message si pas de donn√©es -->
    <div *ngIf="!statsData() && !loadingStatsData()" class="creation-card text-center py-12">
      <svg class="w-16 h-16 text-gray-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
      </svg>
      <h3 class="text-xl font-semibold text-gray-400 mb-2">Aucun graphique affich√©</h3>
      <p class="text-gray-500">S√©lectionnez une semaine et une ligne pour g√©n√©rer les graphiques statistiques</p>
    </div>
  </div>
</div>

  <!-- Message de succ√®s -->
  <div *ngIf="showSuccess()" class="success-notification">
    <div class="success-content">
      <svg class="w-6 h-6 mr-3 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
      </svg>
      {{ successMessage() }}
    </div>
  </div>

  <!-- Loader global -->
  <div *ngIf="loading() && activeTab() === 'view'" class="loader-overlay">
    <div class="loader-container">
      <div class="industrial-loader"></div>
      <p class="text-cyan-400 mt-4 font-semibold">Chargement des donn√©es...</p>
    </div>
  </div>
